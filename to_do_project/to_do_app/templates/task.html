{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <link rel="stylesheet" href="{% static 'style.css' %}?v={% now 'U' %}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap JS (required for dropdowns) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</head>

<body>
    <header class="the_header">
        <br></br>
        <br></br>
        <h1 class="the_h1">Your Tasks</h1>
    </header>

    <!-- Add this block to display messages -->
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}"><span class = "main-message">{{ message }}</span></div>
            {% endfor %}
        </div>
    {% endif %}

    <main>
        <div class="task-container" style="flex-direction: column; align-items: stretch;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #333;">My Tasks</h2>
                <a href="{% url 'add_task' %}">
                    <button class="the_button grow-btn new_task" style="margin: 0;">+ Add Task</button>
                </a>
            </div>

            <div class="task-list">
                {% for todo in todos %}
                <div class="task-card">
                    <div class="task-title">
                        <ul class="list-unstyled m-0">
                          <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" id="navbarDropdownCategories"
                               href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                              {{ todo.title }}
                            </a>
                      
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdownCategories">
                              <li>
                                <a class="dropdown-item">
                                  {{ todo.description }}
                                </a>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </div>
                    
                    <div class="task-actions" style="display: flex; justify-content: space-between;">
                        <form action="{% url 'deletetask' todo.id %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="the_button grow-btn delete-button"
                                style="padding: 5px 10px; background-color:rgb(255, 68, 68);">Delete</button>
                        </form>
                        <form action="{% url 'complete_task' todo.id %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="the_button grow-btn"
                                style="padding: 5px 10px; background-color:rgb(74, 255, 68);">Complete</button>
                        </form>
                    </div>
                    <div class="task-meta">
                        <span>{{ todo.due_date|default:"No due date" }}</span>
                        <span>{{ todo.completed|yesno:"Done,Pending" }}</span>
                    </div>
                </div>
                {% empty %}
                <p style="text-align: center; color: #666;">No tasks yet. Add one!</p>
                {% endfor %}
               
                
            </div>
        </div>

</body>

</html>